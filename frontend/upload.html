<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Data - DTE Rajasthan</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="https://via.placeholder.com/40x40/1e40af/ffffff?text=DTE" alt="DTE Logo" class="logo">
                <h1>DTE Rajasthan - Upload Student Data</h1>
            </div>
            <div class="header-actions">
                <a href="/" class="btn-secondary">‚Üê Back to Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content upload-page">
        <!-- Step 1: File Upload -->
        <div id="step-1" class="upload-step active">
            <div class="card">
                <div class="card-header">
                    <h2>Step 1: Upload Your Data File</h2>
                    <p>Upload CSV or Excel file with student information</p>
                </div>
                <div class="card-content">
                    <!-- File Drop Zone -->
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-content">
                            <div class="upload-icon">üìÅ</div>
                            <h3>Drag & Drop your file here</h3>
                            <p>or <button class="btn-link" onclick="document.getElementById('file-input').click()">browse files</button></p>
                            <p class="file-info">Supports: .csv, .xlsx, .xls files</p>
                        </div>
                        <input type="file" id="file-input" accept=".csv,.xlsx,.xls" style="display: none;">
                    </div>

                    <!-- Sample Format -->
                    <div class="sample-format">
                        <h4>Expected Format:</h4>
                        <div class="format-example">
                            <table class="sample-table">
                                <thead>
                                    <tr>
                                        <th>student_id</th>
                                        <th>name</th>
                                        <th>attendance</th>
                                        <th>marks</th>
                                        <th>family_income</th>
                                        <th>...</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>STU001</td>
                                        <td>Student Name</td>
                                        <td>85</td>
                                        <td>78</td>
                                        <td>250000</td>
                                        <td>...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn-secondary" onclick="downloadSampleFormat()">üì• Download Sample Format</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Column Mapping -->
        <div id="step-2" class="upload-step">
            <div class="card">
                <div class="card-header">
                    <h2>Step 2: Map Your Columns</h2>
                    <p>Match your file columns to system fields</p>
                </div>
                <div class="card-content">
                    <div class="mapping-container">
                        <div class="file-preview">
                            <h4>Your File Preview:</h4>
                            <div id="file-preview-table"></div>
                        </div>
                        
                        <div class="column-mapping">
                            <h4>Column Mapping:</h4>
                            <div id="mapping-form">
                                <!-- Mapping controls will be generated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
                        <button class="btn-primary" onclick="processData()">Process Data ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Processing & Results -->
        <div id="step-3" class="upload-step">
            <div class="card">
                <div class="card-header">
                    <h2>Step 3: Processing Results</h2>
                </div>
                <div class="card-content">
                    <div id="processing-status" class="processing-status">
                        <div class="spinner"></div>
                        <p>Processing your data...</p>
                    </div>
                    
                    <div id="results-summary" class="results-summary" style="display: none;">
                        <div class="result-stats">
                            <div class="stat-item">
                                <h3 id="processed-count">0</h3>
                                <p>Students Processed</p>
                            </div>
                            <div class="stat-item alert">
                                <h3 id="high-risk-count">0</h3>
                                <p>High Risk Students</p>
                            </div>
                            <div class="stat-item success">
                                <h3 id="ml-accuracy">0%</h3>
                                <p>ML Model Accuracy</p>
                            </div>
                        </div>
                        
                        <div class="validation-results">
                            <h4>Data Validation:</h4>
                            <div id="validation-messages"></div>
                        </div>
                        
                        <div class="step-actions">
                            <button class="btn-primary" onclick="goToDashboard()">View Dashboard ‚Üí</button>
                            <button class="btn-secondary" onclick="uploadAnother()">Upload Another File</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
        <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Upload</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Map Columns</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Process</div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/upload.js"></script>
</body>
</html>